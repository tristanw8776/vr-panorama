<!DOCTYPE html>
<html>
  <head>
    <title>360Â° Panorama VR Viewer</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/aframe/1.4.2/aframe.min.js"></script>
    <style>
      #startButton {
        position: fixed;
        bottom: 20px;
        left: 50%;
        transform: translateX(-50%);
        background: #4CAF50;
        color: white;
        padding: 15px 30px;
        border-radius: 5px;
        border: none;
        font-size: 16px;
        z-index: 999;
        cursor: pointer;
      }
    </style>
  </head>
  <body>
    <button id="startButton">Start VR Mode</button>
    
    <a-scene>
      <a-assets>
        <img id="panorama" src="Panorama_Tharpe%20Street%20Site%20Layout_v2%2020220902_r20_2025-02-12-15-29-31.jpg">
      </a-assets>
      
      <!-- Left eye -->
      <a-camera id="left-eye" position="0 1.6 0" stereoscopic="eye:left">
        <a-sky src="#panorama" rotation="0 -90 0"></a-sky>
      </a-camera>
      
      <!-- Right eye -->
      <a-camera id="right-eye" position="0 1.6 0" stereoscopic="eye:right">
        <a-sky src="#panorama" rotation="0 -90 0"></a-sky>
      </a-camera>
    </a-scene>

    <script>
      document.getElementById('startButton').addEventListener('click', function() {
        // Request device orientation permissions for iOS
        if (typeof DeviceOrientationEvent !== 'undefined' && typeof DeviceOrientationEvent.requestPermission === 'function') {
          DeviceOrientationEvent.requestPermission()
            .then(response => {
              if (response === 'granted') {
                enableVRMode();
              }
            })
            .catch(console.error);
        } else {
          enableVRMode();
        }
      });

      function enableVRMode() {
        // Hide the button
        document.getElementById('startButton').style.display = 'none';
        
        // Force landscape orientation
        if (screen.orientation && screen.orientation.lock) {
          screen.orientation.lock('landscape').catch(function(error) {
            console.log(error);
          });
        }
        
        // Enable stereo rendering
        const scene = document.querySelector('a-scene');
        scene.setAttribute('vr-mode', 'enabled: true');
        
        // Apply stereoscopic mode
        const leftCamera = document.querySelector('#left-eye');
        const rightCamera = document.querySelector('#right-eye');
        
        leftCamera.setAttribute('stereoscopic', 'eye:left');
        rightCamera.setAttribute('stereoscopic', 'eye:right');
        
        // Enable device orientation controls
        leftCamera.setAttribute('look-controls', {
          touchEnabled: true,
          magicWindowTrackingEnabled: true
        });
        rightCamera.setAttribute('look-controls', {
          touchEnabled: true,
          magicWindowTrackingEnabled: true
        });
      }
    </script>
  </body>
</html>
